\documentclass{apa6}
\usepackage{tikz}
\usepackage{graphicx}
\usepackage{xparse}
\usepackage{adjustbox}
\usepackage{ifthen}
\usetikzlibrary{calc}

\input{./corner_metadata.tex}

\NewDocumentCommand{\framedbox}{ O{} m }{%

  \begin{tikzpicture}
    \pgfkeys{/framedbox/.cd, #1} % Set the keys based on the optional argument

    \coordinate (northwest) at (0, \fbheight);
    \coordinate (northeast) at (\fbwidth, \fbheight);
    \coordinate (southwest) at (0, 0);
    \coordinate (southeast) at (\fbwidth, 0);

    \def\nwcorner{corners/\fbcorner.png}
    \def\necorner{corners/\fbcorner.png}
    \def\swcorner{corners/\fbcorner.png}
    \def\secorner{corners/\fbcorner.png}

    \def\offsetx
      {\fbcornersize * \getcornermetadata{\fbcorner}{offsetx} /
       \getcornermetadata{\fbcorner}{width}}
    \def\offsety
      {\fbcornersize * \getcornermetadata{\fbcorner}{offsety} /
       \getcornermetadata{\fbcorner}{width}}
    \def\extrax
      {\fbcornersize * \getcornermetadata{\fbcorner}{extrax} /
       \getcornermetadata{\fbcorner}{width}}
    \def\extray
      {\fbcornersize * \getcornermetadata{\fbcorner}{extray} /
       \getcornermetadata{\fbcorner}{width}}

    \def\horizontallinethickness
      {\fbcornersize * \getcornermetadata{\fbcorner}{horizontallinethickness} /
       \getcornermetadata{\fbcorner}{width}}
    \def\verticallinethickness
      {\fbcornersize * \getcornermetadata{\fbcorner}{verticallinethickness} /
       \getcornermetadata{\fbcorner}{width}}

    \ifthenelse{\equal{\fbmode}{full} \OR \equal{\fbmode}{diagonal}}
    {
      \node[anchor=north west, inner sep=0pt]
        (cornernorthwest) at (northwest)
        {\includegraphics[width=\fbcornersize]{\nwcorner}};
      \node[anchor=south east, inner sep=0pt]
        (cornersoutheast)at (southeast)
        {\adjustbox{scale={-1}{-1}}
        {\includegraphics[width=\fbcornersize]{\secorner}}};

      \coordinate (toplinestart) at ($(cornernorthwest.north east) + (\extrax, 0)$);
      \coordinate (leftlinestart) at ($(cornernorthwest.south west) - (0, \extray)$);
      \coordinate (bottomlineend) at ($(cornersoutheast.south west) - (\extrax, 0)$);
      \coordinate (rightlineend) at ($(cornersoutheast.north east) + (0, \extray)$);
    }
    {
      \node (cornernorthwest)
        [minimum size=0pt, inner sep=0pt, outer sep=0pt, opacity=0] at
        (northwest) {};
      \node (cornersoutheast)
        [minimum size=0pt, inner sep=0pt, outer sep=0pt, opacity=0] at
        (southeast) {};

      \coordinate (toplinestart) at
      ($(northwest) + (\offsetx, 0) + (\verticallinethickness / 2, 0)$);
      \coordinate (leftlinestart) at
      ($(northwest) - (0, \offsety) - (0, \horizontallinethickness / 2)$);
      \coordinate (bottomlineend) at
      ($(southeast) - (\offsetx, 0) - (\verticallinethickness / 2, 0)$);
      \coordinate (rightlineend) at
      ($(southeast) + (0, \offsety) + (0, \horizontallinethickness / 2)$);
    }

    \ifthenelse{\equal{\fbmode}{full} \OR \equal{\fbmode}{antidiagonal}}
    {
      \node[anchor=north east, inner sep=0pt]
        (cornernortheast) at (northeast)
        {\adjustbox{scale={-1}{1}}
        {\includegraphics[width=\fbcornersize]{\necorner}}};
      \node[anchor=south west, inner sep=0pt]
        (cornersouthwest)at (southwest)
        {\adjustbox{scale={1}{-1}}
        {\includegraphics[width=\fbcornersize]{\swcorner}}};

      \coordinate (toplineend) at
      ($(cornernortheast.north west) - (\extrax, 0)$);
      \coordinate (rightlinestart) at
      ($(cornernortheast.south east) - (0, \extray)$);
      \coordinate (bottomlinestart) at
      ($(cornersouthwest.south east) + (\extrax, 0)$);
      \coordinate (leftlineend) at
      ($(cornersouthwest.north west) + (0, \extray)$);
    }
    {
      \node (cornernortheast)
        [minimum size=0pt, inner sep=0pt, outer sep=0pt, opacity=0] at
        (northeast) {};
      \node (cornersouthwest)
        [minimum size=0pt, inner sep=0pt, outer sep=0pt, opacity=0] at
        (southwest) {};

      \coordinate (toplineend) at
      ($(northeast) - (\offsetx, 0) - (\verticallinethickness / 2, 0)$);
      \coordinate (rightlinestart) at
      ($(northeast) - (0, \offsety) - (0, \horizontallinethickness / 2)$);
      \coordinate (bottomlinestart) at
      ($(southwest) + (\offsetx, 0) + (\verticallinethickness / 2, 0)$);
      \coordinate (leftlineend) at
      ($(southwest) + (0, \offsety) + (0, \horizontallinethickness / 2)$);
    }

    % top line
    \draw[line width={\horizontallinethickness}]
      ([yshift={- \offsety - \horizontallinethickness}] toplinestart) --
      ([yshift={- \offsety - \horizontallinethickness}] toplineend);

    % bottom line
    \draw[line width={\horizontallinethickness}]
      ([yshift={\offsety + \horizontallinethickness}] bottomlinestart) --
      ([yshift={\offsety + \horizontallinethickness}] bottomlineend);

    % left line
    \draw[line width={\verticallinethickness}]
      ([xshift={\offsetx + \verticallinethickness}] leftlinestart) --
      ([xshift={\offsetx + \verticallinethickness}] leftlineend);

    % right line
    \draw[line width={\verticallinethickness}]
      ([xshift={- \offsetx - \verticallinethickness}] rightlinestart) --
      ([xshift={- \offsetx - \verticallinethickness}] rightlineend);

    \node (content) at (\fbwidth/2, \fbheight/2)
      {\parbox{\fbwidth}{\centering #2}};
 \end{tikzpicture}
}

\pgfkeys{/framedbox/.cd,
  width/.store in=\fbwidth,
  width=5cm, % Default width
  height/.store in=\fbheight,
  height=4cm, % Default height
  cornersize/.store in=\fbcornersize,
  cornersize=0.5cm,
  corner/.store in=\fbcorner,
  corner=style01,
  mode/.store in=\fbmode,
  mode=full,
}

\begin{document}
\def\style{style25}

\framedbox[width=6cm, height=4cm, corner=\style, cornersize=1cm, mode=full]
  {This is some sample content within the box.}

\vspace{1cm}

\framedbox[width=6cm, height=4cm, corner=\style, cornersize=1cm, mode=diagonal]
  {This is some sample content within the box.}

\vspace{1cm}

\framedbox[width=6cm, height=4cm, corner=\style, cornersize=1cm, mode=antidiagonal]
  {This is some sample content within the box.}

\end{document}
